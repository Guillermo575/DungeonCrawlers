<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>_Gamelibrary</name>
    <events>
        <variable constant="0" name="GameMode" sid="200313099251393" static="0" type="text">UP</variable>
        <variable comment="Difficult configured in the game (Easy, Normal, Hard)" constant="0" name="ConfigDifficult" sid="376289247331375" static="0" type="text">Easy</variable>
        <variable comment="Last Level Loaded" constant="0" name="LastLevel" sid="401210357883922" static="0" type="text"></variable>
        <variable comment="Last level Info Data in a JSON" constant="0" name="LastLevelJSON" sid="622867184603336" static="0" type="text"></variable>
        <variable comment="Value that indicates if all components are loaded" constant="0" name="LoadComplete" sid="107025194594051" static="0" type="number">0</variable>
        <variable comment="Alternate Event if dont load because an error" constant="0" name="LoadWait" sid="569168715090754" static="0" type="number">0</variable>
        <comment>This sheet works as a general library of all the sheets used for the gameplay</comment>
        <include>Menu_Pause</include>
        <include>Audio</include>
        <include>Enemies</include>
        <include>Player</include>
        <include>Battle</include>
        <include>Spriter_Animation</include>
        <include>GenericItem</include>
        <include>HUD</include>
        <include>DialogueEvents</include>
        <include>LightIlumination</include>
        <include>TileAnimation</include>
        <comment>This function loads the last level in this variable, useful for &quot;try again?&quot; Option</comment>
        <event-block sid="997569491700789">
            <conditions>
                <condition id="-2" name="On start of layout" sid="742313244731414" type="System" />
            </conditions>
            <actions>
                <action id="-9" name="Set value" sid="557631137415762" type="System">
                    <param id="0" name="Variable">LoadComplete</param>
                    <param id="1" name="Value">0</param>
                </action>
                <action id="-9" name="Set value" sid="180557712407877" type="System">
                    <param id="0" name="Variable">LoadWait</param>
                    <param id="1" name="Value">0</param>
                </action>
                <action id="-9" name="Set value" sid="512536200845487" type="System">
                    <param id="0" name="Variable">LastLevel</param>
                    <param id="1" name="Value">LayoutName</param>
                </action>
                <action id="-25" name="Move to bottom" sid="584398248476612" type="DoorDungeon" />
                <action id="0" name="Call function" sid="449783667401302" type="Function">
                    <param id="0" name="Name">&quot;CreateHUDFloorName&quot;</param>
                    <param id="1" name="Parameter {n}">330{###}30{###}&quot;Floor &quot;&amp; Array_Levels.Actual</param>
                </action>
                <action id="0" name="Call function" sid="495353101910765" type="Function">
                    <param id="0" name="Name">&quot;LightOn&quot;</param>
                    <param id="1" name="Parameter {n}"></param>
                </action>
                <action disabled="1" id="0" name="Call function" sid="771115418693452" type="Function">
                    <param id="0" name="Name">&quot;LightOff&quot;</param>
                    <param id="1" name="Parameter {n}"></param>
                </action>
                <action id="1" name="Set pause state" sid="822846596490126" type="Rex_Pause">
                    <param id="0" name="State">0</param>
                </action>
                <action id="-3" name="Create object" sid="218594336214445" type="System">
                    <param id="0" name="Object to create">Loading_Screen</param>
                    <param id="1" name="Layer">&quot;Pause&quot;</param>
                    <param id="2" name="X">0</param>
                    <param id="3" name="Y">0</param>
                </action>
                <action id="0" name="Spawn another object" sid="674588385311132" type="Loading_Screen">
                    <param id="0" name="Object">Load_Bar</param>
                    <param id="1" name="Layer">&quot;Pause&quot;</param>
                    <param id="2" name="Image point">&quot;LoadBar&quot;</param>
                </action>
                <action id="0" name="Spawn another object" sid="909835808714284" type="Loading_Screen">
                    <param id="0" name="Object">Load_BarFrame</param>
                    <param id="1" name="Layer">&quot;Pause&quot;</param>
                    <param id="2" name="Image point">&quot;LoadBar&quot;</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="137777959629129">
            <conditions>
                <condition id="-18" name="On created" sid="393055990070145" type="PlayerCoreBox" />
            </conditions>
            <actions>
                <action id="0" name="Call function" sid="293025316931806" type="Function">
                    <param id="0" name="Name">&quot;CreateCharacter&quot;</param>
                    <param id="1" name="Parameter {n}">PlayerCoreBox.UID</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="979470083766102">
            <conditions>
                <condition id="-18" name="On created" sid="302959798680125" type="EnemyCoreBox" />
            </conditions>
            <actions>
                <action id="0" name="Call function" sid="137594306737961" type="Function">
                    <param id="0" name="Name">&quot;CreateEnemy&quot;</param>
                    <param id="1" name="Parameter {n}">EnemyCoreBox.UID</param>
                </action>
            </actions>
        </event-block>
        <comment>This function check the next array position that correspond each level, if you complete all the positions you complete the game!</comment>
        <event-block sid="663186515570838">
            <conditions>
                <condition id="0" name="On function" sid="529675522561937" type="Function">
                    <param id="0" name="Name">&quot;NextLevel&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="0" name="Call function" sid="541284307099078" type="Function">
                    <param id="0" name="Name">&quot;Destroy_MiniMap&quot;</param>
                    <param id="1" name="Parameter {n}"></param>
                </action>
                <action id="11" name="Clear Dungeon" sid="482801274799804" type="RandomDungeonMaker" />
                <action id="-11" name="Add to" sid="920295836291568" type="Array_Levels">
                    <param id="0" name="Instance variable">Actual</param>
                    <param id="1" name="Value">1</param>
                </action>
                <action id="0" name="Call function" sid="777239461022679" type="Function">
                    <param id="0" name="Name">&quot;LogPlayerSave&quot;</param>
                    <param id="1" name="Parameter {n}">PlayerCoreBox.UID{###}0</param>
                </action>
            </actions>
            <sub-events>
                <event-block sid="656898926951013">
                    <conditions>
                        <condition id="-7" name="Compare instance variable" sid="658625596986542" type="Array_Levels">
                            <param id="0" name="Instance variable">Actual</param>
                            <param id="1" name="Comparison">2</param>
                            <param id="2" name="Value">Array_Levels.Width</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-25" name="Go to layout (by name)" sid="350511838523507" type="System">
                            <param id="0" name="Layout">Array_Levels.At(Array_Levels.Actual)</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="172681257085302">
                    <conditions>
                        <condition id="-22" name="Else" sid="503190069238419" type="System" />
                    </conditions>
                    <actions>
                        <action id="-2" name="Go to layout" sid="165082355468128" type="System">
                            <param id="0" name="Layout">Menu_Congratulations</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
        <event-block sid="101507431149009">
            <conditions>
                <condition id="0" name="On function" sid="523884088442134" type="Function">
                    <param id="0" name="Name">&quot;TransportLayout&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="0" name="Call function" sid="337653451405062" type="Function">
                    <param id="0" name="Name">&quot;LogPlayerSave&quot;</param>
                    <param id="1" name="Parameter {n}">PlayerCoreBox.UID{###}0</param>
                </action>
                <action id="-25" name="Go to layout (by name)" sid="518976169679518" type="System">
                    <param id="0" name="Layout">Function.Param(0)</param>
                </action>
            </actions>
        </event-block>
        <comment>Door opened &amp; Pick Key</comment>
        <event-block any="1" sid="426865335190726">
            <conditions>
                <condition id="-8" name="Compare two values" sid="124921619618357" type="System">
                    <param id="0" name="First value">Item_Key.Count</param>
                    <param id="1" name="Comparison">0</param>
                    <param id="2" name="Second value">0</param>
                </condition>
            </conditions>
            <actions>
                <action id="-13" name="Set boolean" sid="329787743358649" type="DoorDungeon">
                    <param id="0" name="Instance variable">Locked</param>
                    <param id="1" name="Value">0</param>
                </action>
                <action id="4" name="Set animation" sid="860063229095452" type="DoorDungeon">
                    <param id="0" name="Animation">&quot;Open&quot;</param>
                    <param id="1" name="From">1</param>
                </action>
            </actions>
        </event-block>
        <event-block any="1" sid="108606357130226">
            <conditions>
                <condition id="-7" name="Compare instance variable" sid="530466834376677" type="DoorDungeon">
                    <param id="0" name="Instance variable">KeyLock</param>
                    <param id="1" name="Comparison">0</param>
                    <param id="2" name="Value">0</param>
                </condition>
                <condition id="-8" inverted="1" name="Is boolean instance variable set" sid="953459538530836" type="DoorDungeon">
                    <param id="0" name="Instance variable">Locked</param>
                </condition>
            </conditions>
            <actions>
                <action id="-13" name="Set boolean" sid="828798719934864" type="DoorDungeon">
                    <param id="0" name="Instance variable">Locked</param>
                    <param id="1" name="Value">0</param>
                </action>
                <action id="4" name="Set animation" sid="846389700948197" type="DoorDungeon">
                    <param id="0" name="Animation">&quot;Open&quot;</param>
                    <param id="1" name="From">1</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="333980999808000">
            <conditions>
                <condition id="1" name="Is overlapping another object" sid="190864341160787" type="PlayerCoreBox">
                    <param id="0" name="Object">DoorDungeon</param>
                </condition>
                <condition id="-11" name="For Each" sid="883465158461655" type="System">
                    <param id="0" name="Object">Item_Key</param>
                </condition>
                <condition id="-8" name="Compare two values" sid="531169422899990" type="System">
                    <param id="0" name="First value">Item_Key.FO_Pin2.PinnedUID</param>
                    <param id="1" name="Comparison">0</param>
                    <param id="2" name="Second value">PlayerCoreBox.UID</param>
                </condition>
            </conditions>
            <actions>
                <action id="-9" name="Destroy" sid="385679304838776" type="Item_Key" />
                <action id="-12" name="Subtract from" sid="166124661140012" type="DoorDungeon">
                    <param id="0" name="Instance variable">KeyLock</param>
                    <param id="1" name="Value">1</param>
                </action>
                <action id="-13" name="Set boolean" sid="909334112314358" type="PlayerCoreBox">
                    <param id="0" name="Instance variable">KeyPick</param>
                    <param id="1" name="Value">0</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="801789085647739">
            <conditions>
                <condition id="1" name="Is overlapping another object" sid="129066864593782" type="Family_Character">
                    <param id="0" name="Object">Item_Key</param>
                </condition>
                <condition behavior="FO_Pin2" id="0" inverted="1" name="Is pinned" sid="927289479803321" type="Item_Key" />
                <condition id="-8" inverted="1" name="Is boolean instance variable set" sid="218974674288537" type="Family_Character">
                    <param id="0" name="Instance variable">KeyPick</param>
                </condition>
            </conditions>
            <actions>
                <action behavior="FO_Pin2" id="0" name="Pin to object" sid="926597023156674" type="Item_Key">
                    <param id="0" name="Pin to">Family_Character</param>
                    <param id="1" name="Mode">3</param>
                </action>
                <action id="-13" name="Set boolean" sid="226655126735342" type="Family_Character">
                    <param id="0" name="Instance variable">KeyPick</param>
                    <param id="1" name="Value">1</param>
                </action>
            </actions>
        </event-block>
        <comment>Load Bar Function</comment>
        <event-block sid="367935428190049">
            <conditions>
                <condition id="2" name="Is pause" sid="605819899627861" type="Rex_Pause" />
                <condition id="-14" name="Compare variable" sid="245681207110773" type="System">
                    <param id="0" name="Variable">LoadComplete</param>
                    <param id="1" name="Comparison">0</param>
                    <param id="2" name="Value">0</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <variable constant="0" name="LoadCount" sid="690484895628352" static="0" type="number">0</variable>
                <event-block sid="192875118121796">
                    <conditions>
                        <condition id="-11" name="For Each" sid="745210652377562" type="System">
                            <param id="0" name="Object">Family_Load</param>
                        </condition>
                        <condition id="-8" name="Is boolean instance variable set" sid="340799512322316" type="Family_Load">
                            <param id="0" name="Instance variable">Loaded</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-10" name="Add to" sid="127568919090619" type="System">
                            <param id="0" name="Variable">LoadCount</param>
                            <param id="1" name="Value">1</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="709794459140170">
                    <conditions>
                        <condition id="-11" name="For Each" sid="721229658162723" type="System">
                            <param id="0" name="Object">Family_Tilemaps</param>
                        </condition>
                        <condition id="-8" name="Is boolean instance variable set" sid="728128253453885" type="Family_Tilemaps">
                            <param id="0" name="Instance variable">Loaded</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-10" name="Add to" sid="344013150346917" type="System">
                            <param id="0" name="Variable">LoadCount</param>
                            <param id="1" name="Value">1</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="913225227482967">
                    <conditions />
                    <actions>
                        <action id="-5" name="Set width" sid="602733844366274" type="Load_Bar">
                            <param id="0" name="Width">((LoadCount * 1)/(Family_Load.Count + Family_Tilemaps.Count)) * Load_BarFrame.Width</param>
                        </action>
                    </actions>
                </event-block>
                <event-block any="1" sid="222812192831773">
                    <conditions>
                        <condition id="-14" name="Compare variable" sid="981998255932803" type="System">
                            <param id="0" name="Variable">LoadCount</param>
                            <param id="1" name="Comparison">5</param>
                            <param id="2" name="Value">Family_Load.Count + Family_Tilemaps.Count</param>
                        </condition>
                        <condition id="-14" name="Compare variable" sid="853257211476366" type="System">
                            <param id="0" name="Variable">LoadWait</param>
                            <param id="1" name="Comparison">5</param>
                            <param id="2" name="Value">(Family_Load.Count + Family_Tilemaps.Count)*10</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-9" name="Set value" sid="376248868944213" type="System">
                            <param id="0" name="Variable">LoadComplete</param>
                            <param id="1" name="Value">1</param>
                        </action>
                        <action id="1" name="Set pause state" sid="893841080845384" type="Rex_Pause">
                            <param id="0" name="State">1</param>
                        </action>
                        <action id="0" name="Call function" sid="406871123338225" type="Function">
                            <param id="0" name="Name">&quot;CreatePauseMenu&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                        <action id="-9" name="Destroy" sid="682253767675903" type="Loading_Screen" />
                        <action id="-9" name="Destroy" sid="521278680673554" type="Load_Bar" />
                        <action id="-9" name="Destroy" sid="394474984514879" type="Load_BarFrame" />
                    </actions>
                </event-block>
                <event-block sid="649266280579255">
                    <conditions>
                        <condition id="-22" name="Else" sid="549228957453087" type="System" />
                    </conditions>
                    <actions>
                        <action id="-10" name="Add to" sid="829338765423434" type="System">
                            <param id="0" name="Variable">LoadWait</param>
                            <param id="1" name="Value">1</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
        <comment>Special Functions</comment>
        <event-block sid="143907813422825">
            <conditions>
                <condition id="0" name="On function" sid="757985406358839" type="Function">
                    <param id="0" name="Name">&quot;Activate_AI&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="-13" name="Set boolean" sid="868214737131851" type="Family_AI">
                    <param id="0" name="Instance variable">AIActive</param>
                    <param id="1" name="Value">1</param>
                </action>
                <action id="-13" name="Set boolean" sid="299899618419579" type="Family_NPC">
                    <param id="0" name="Instance variable">CanTalk</param>
                    <param id="1" name="Value">0</param>
                </action>
            </actions>
        </event-block>
        <event-block sid="812983716261524">
            <conditions>
                <condition id="0" name="On function" sid="632347531975179" type="Function">
                    <param id="0" name="Name">&quot;Heal_Player&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="-10" name="Set value" sid="762197142456678" type="PlayerCoreBox">
                    <param id="0" name="Instance variable">Hp</param>
                    <param id="1" name="Value">PlayerCoreBox.HPMax</param>
                </action>
            </actions>
        </event-block>
    </events>
</c2eventsheet>
